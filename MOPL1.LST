Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 1
mopl1.asm



      1					 ;*******************************************************************************************
      2					 ********
      3					 ; MOPL1.ASM - учебный пример для выполнения
      4					 ; лабораторной	работы N1 по машинно-ориентированному программированию
      5					 ;*******************************************************************************************
      6					 ********
      7	    0000				 .MODEL	SMALL
      8	    0000				 .STACK	200h
      9						 .386
     10					 ;	 Используются декларации констант и макросов
     11						 INCLUDE MOPL1.INC
1    12					 ;*********************************************************
1    13					 ; Константы для учебного примера лабораторной работы N	1  *
1    14					 ; по МОП.						   *
1    15					 ;*********************************************************
1    16
1    17		  =001B			 CHESC	 = 1Bh
1    18		  =000D			 CHCR	 = 13
1    19		  =003D			 CHSEP	 = '='
1    20		  =0060			 CHCOMMA = '`'
1    21		  =000A			 CHLF	 = 10
1    22		  =0021			 DOSFU	 = 21h
1    23		  =0002			 FUPUTC	 = 2
1    24		  =0008			 FUGETCH = 8
1    25		  =000A			 FUGETS	 = 0Ah
1    26		  =004C			 FUEXIT	 = 4Ch
1    27		  =0000			 PAUSE_L = 0000	 ; Младшее слово стартового значения паузы
1    28		  =0000			 PAUSE_H = 0	 ; Старшее слово
1    29		  =0012			 LENNUM	 = 18	 ; Число символов в строке десятичного числа
1    30		  =0009			 LENPACK = 9	 ; Упаковонное в два раза короче
1    31
1    32
     33						 INCLUDE MOPL1.MAC
1    34					 ;*********************************************************
1    35					 ; Макросы для учебного	примера	лабораторной работы N 1	   *
1    36					 ; по МОП.						   *
1    37					 ;*********************************************************
1    38
1    39					 ; Макрос вывода строки	LINE
1    40					 PUTL	 MACRO LINE
1    41						 LEA   SI,   LINE
1    42						 XOR   CX,   CX
1    43						 XOR   DX,   DX
1    44						 XOR   AX,   AX
1    45						 CALL  PUTSS
1    46						 ENDM
1    47
1    48					 ; Макрос вывода строки	LINE с задержкой PAUSE
1    49					 PUTLS	 MACRO LINE
1    50						 XOR   AX,   AX
1    51						 LEA   SI,   LINE
1    52						 MOV   DX,   PAUSE
1    53						 MOV   CX,   PAUSE+2
1    54						 CALL  PUTSS
1    55						 ENDM
1    56
1    57					 ; Как и PUTLS,	но с центрированием посередине
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 2
mopl1.asm



1    58					 PUTLSC	 MACRO LINE
1    59						 LOCAL LO, NOMARG
1    60						 LEA   SI,   LINE
1    61						 CALL  SLEN
1    62						 MOV   CX, 80
1    63						 SUB   CX, AX
1    64						 SAR   CX,  1
1    65						 JZ    NOMARG
1    66					 LO:	 MOV   AL, ' '
1    67						 CALL  PUTC
1    68						 LOOP  LO
1    69					 NOMARG: PUTLS LINE
1    70						 ENDM
1    71
1    72					 ; Макрос фиксации начала измерения времени
1    73					 ; Заносит в стек младшее слово	числа тактов системных часов
1    74					 FIXTIME MACRO
1    75						 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1    76						 PUSH	 EDX
1    77						 PUSH	 EAX
1    78						 ENDM
1    79
1    80					 ; Макрос получения в <EDX,EAX>	числа тактов, прошедших	с последнего
1    81					 ; момента фиксации времени. Извлекает продукт FIXTIME из стека
1    82					 DURAT	 MACRO
1    83						 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1    84						 POP	 EBX
1    85						 SUB	 EAX,	 EBX
1    86						 POP	 EBX
1    87						 SBB	 EDX,	 EBX
1    88						 ENDM
1    89
1    90					 ; Макрос завершения программы
1    91					 EXIT	 MACRO
1    92						 MOV	 AH, FUEXIT
1    93						 MOV	 AL, 0
1    94						 INT	 DOSFU
1    95						 ENDM
1    96
     97
     98					 ; Декларации данных
     99	    0000				 .DATA
    100	    0000  4E*(3D) 00		 SLINE	 DB	 78 DUP	(CHSEP), 0
    101	    004F  46 69	6D 69 6C 69 79+	 REQ	 DB	 "Fimiliya I.O.: ",0FFh
    102		  61 20	49 2E 4F 2E 3A+
    103		  20 FF
    104	    005F  4D 49	4E 49 53 54 45+	 MINIS	 DB	 "MINISTERSTVO OBRAZOVANIYA ROSSIJSKOJ FEDERACII",0
    105		  52 53	54 56 4F 20 4F+
    106		  42 52	41 5A 4F 56 41+
    107		  4E 49	59 41 20 52 4F+
    108		  53 53	49 4A 53 4B 4F+
    109		  4A 20	46 45 44 45 52+
    110		  41 43	49 49 00
    111	    008E  55 4C	27 59 41 4E 4F+	 ULSTU	 DB	 "UL'YANOVSKIJ GOSUDARSTVENNYJ TEKHNICHESKIJ UNIVERSITET",0
    112		  56 53	4B 49 4A 20 47+
    113		  4F 53	55 44 41 52 53+
    114		  54 56	45 4E 4E 59 4A+
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 3
mopl1.asm



    115		  20 54	45 4B 48 4E 49+
    116		  43 48	45 53 4B 49 4A+
    117		  20 55	4E 49 56 45 52+
    118		  53 49	54 45 54 00
    119	    00C5  4B 61	66 65 64 72 61+	 DEPT	 DB	 "Kafedra vychislitel'noj tekhniki",0
    120		  20 76	79 63 68 69 73+
    121		  6C 69	74 65 6C 27 6E+
    122		  6F 6A	20 74 65 6B 68+
    123		  6E 69	6B 69 00
    124	    00E6  4D 61	73 68 69 6E 6E+	 MOP	 DB	 "Mashinno-orientirovannoe programmirovanie",0
    125		  6F 2D	6F 72 69 65 6E+
    126		  74 69	72 6F 76 61 6E+
    127		  6E 6F	65 20 70 72 6F+
    128		  67 72	61 6D 6D 69 72+
    129		  6F 76	61 6E 69 65 00
    130	    0110  4C 61	62 6F 72 61 74+	 LABR	 DB	 "Laboratornaya	rabota N 1",0
    131		  6F 72	6E 61 79 61 20+
    132		  72 61	62 6F 74 61 20+
    133		  4E 20	31 00
    134	    0129  43 61	6C 63 75 6C 61+	 Choc	 DB	 "Calculate?", 0
    135		  74 65	3F 00
    136	    0134  5A 61	6D 65 64 6C 69+	 REQ1	 DB	 "Zamedlit' vremya raboty v taktah(-), uskorit'	vremya raboty v	taktah (+), +
    137		  74 27	20 76 72 65 6D+	 ", 0
    138		  79 61	20 72 61 62 6F+
    139		  74 79	20 76 20 74 61+
    140		  6B 74	61 68 28 2D 29+
    141		  2C 20	75 73 6B 6F 72+
    142		  69 74	27 20 76 72 65+
    143		  6D 79	61 20 72 61 62+
    144		  6F 74	79 20 76 20 74+
    145		  61 6B	74 61 68 20 28+
    146		  2B 29	2C 00
    147	    017E  20 00			 NEWLINE DB " ", 0
    148					 ;-------------	Новые переменные							    +
    149					 ------------------------------------------------------------------
    150	    0180  76 79	63 68 69 73 6C+	 REQ2	 DB	 "vychislit' funkciyu (f), vyjti(ESC)?", 0
    151		  69 74	27 20 66 75 6E+
    152		  6B 63	69 79 75 20 28+
    153		  66 29	2C 20 76 79 6A+
    154		  74 69	28 45 53 43 29+
    155		  3F 00
    156					 ;-------------------------------------------------------------------------------------------
    157					 ------
    158	    01A5  58 6E	20 3D 20 FF	 X DB "Xn = ",0FFh
    159	    01AB  31 FF			 O_1 DB	"1", 0FFh
    160	    01AD  30 FF			 O_0 DB	"0", 0FFh
    161	    01AF  82 E0	A5 AC EF 20 E0+	 TACTS	 DB	 "Время	работы в тактах: ",0
    162		  A0 A1	AE E2 EB 20 A2+
    163		  20 E2	A0 AA E2 A0 E5+
    164		  3A 20	00
    165	    01C7  4E 20	3D 20 FF	 N DB "N = ",0FFh
    166	    01CC  00 00	00 00 00 00 00+	 XNUM  DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    167		  00 00	00 00 00 00 00+
    168		  00 00	00 00 00 00
    169	    01E0  59 20	3D 20 FF	 Y DB "Y = ",0FFh
    170	    01E5  00 00	00 00 00 00 00+	 YNUM  DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
    171		  00 00	00 00 00 00 00+
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 4
mopl1.asm



    172		  00 00	00 00 00 00
    173	    01F9  00			 EMPTYS	 DB	 0
    174		  =0046			 BUFLEN	= 70
    175	    01FA  46			 BUF	 DB	 BUFLEN
    176	    01FB  ??			 LENS	 DB	 ?
    177	    01FC  46*(00)		 SNAME	 DB	 BUFLEN	DUP (0)
    178	    0242  0000 0000		 PAUSE	 DW	 0, 0 ;	младшее	и старшее слова	задержки при выводе строки
    179	    0246  1B*(??) 00		 TI	 DB	 LENNUM+LENNUM/2 DUP(?), 0 ; строка вывода числа тактов
    180										   ; запас для разделительных "`"
    181
    182					 ;========================= Программа =========================
    183	    0262				 .CODE
    184					 ; Макрос заполнения строки LINE от позиции POS	содержимым CNT объектов,
    185					 ; адресуемых адресом ADR при ширине поля вывода WFLD
    186	    0000			 BEGIN	 LABEL	 NEAR
    187						 ; инициализация сегментного регистра
    188	    0000  B8 0000s			 MOV	 AX,	 @DATA
    189	    0003  8E D8				 MOV	 DS,	 AX
    190						 ; инициализация задержки
    191	    0005  C7 06	0242r 0000		 MOV	 PAUSE,	 PAUSE_L
    192	    000B  C7 06	0244r 0000		 MOV	 PAUSE+2,PAUSE_H
    193						 PUTLS	 REQ	 ; запрос имени
1   194	    0011  33 C0				 XOR   AX,   AX
1   195	    0013  BE 004Fr			 LEA   SI,   REQ
1   196	    0016  8B 16	0242r			 MOV   DX,   PAUSE
1   197	    001A  8B 0E	0244r			 MOV   CX,   PAUSE+2
1   198	    001E  E8 0000e			 CALL  PUTSS
    199						 ; ввод	имени
    200	    0021  BA 01FAr			 LEA	 DX,	 BUF
    201	    0024  E8 0000e			 CALL	 GETS
    202	    0027			 @@L:	 ; циклический процесс повторения вывода заставки
    203						 ; вывод заставки
    204						 ; ИЗМЕРЕНИЕ ВРЕМЕНИ НАЧАТЬ ЗДЕСЬ
    205						 FIXTIME
1   206	    0027  0F 31				 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1   207	    0029  66| 52			 PUSH	 EDX
1   208	    002B  66| 50			 PUSH	 EAX
    209						 PUTL	 EMPTYS
1   210	    002D  BE 01F9r			 LEA   SI,   EMPTYS
1   211	    0030  33 C9				 XOR   CX,   CX
1   212	    0032  33 D2				 XOR   DX,   DX
1   213	    0034  33 C0				 XOR   AX,   AX
1   214	    0036  E8 0000e			 CALL  PUTSS
    215						 PUTL	 SLINE	 ; разделительная черта
1   216	    0039  BE 0000r			 LEA   SI,   SLINE
1   217	    003C  33 C9				 XOR   CX,   CX
1   218	    003E  33 D2				 XOR   DX,   DX
1   219	    0040  33 C0				 XOR   AX,   AX
1   220	    0042  E8 0000e			 CALL  PUTSS
    221						 PUTL	 EMPTYS
1   222	    0045  BE 01F9r			 LEA   SI,   EMPTYS
1   223	    0048  33 C9				 XOR   CX,   CX
1   224	    004A  33 D2				 XOR   DX,   DX
1   225	    004C  33 C0				 XOR   AX,   AX
1   226	    004E  E8 0000e			 CALL  PUTSS
    227						 PUTLSC	 MINIS	 ; первая
1   228	    0051  BE 005Fr			 LEA   SI,   MINIS
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 5
mopl1.asm



1   229	    0054  E8 0000e			 CALL  SLEN
1   230	    0057  B9 0050			 MOV   CX, 80
1   231	    005A  2B C8				 SUB   CX, AX
1   232	    005C  D1 F9				 SAR   CX,  1
1   233	    005E  74 09	90 90			 JZ    ??0001
1   234	    0062  B0 20			 ??0000: MOV   AL, ' '
1   235	    0064  E8 0000e			 CALL  PUTC
1   236	    0067  E2 F9				 LOOP  ??0000
1   237	    0069			 ??0001: PUTLS MINIS
2   238	    0069  33 C0				 XOR   AX,   AX
2   239	    006B  BE 005Fr			 LEA   SI,   MINIS
2   240	    006E  8B 16	0242r			 MOV   DX,   PAUSE
2   241	    0072  8B 0E	0244r			 MOV   CX,   PAUSE+2
2   242	    0076  E8 0000e			 CALL  PUTSS
    243						 PUTL	 EMPTYS
1   244	    0079  BE 01F9r			 LEA   SI,   EMPTYS
1   245	    007C  33 C9				 XOR   CX,   CX
1   246	    007E  33 D2				 XOR   DX,   DX
1   247	    0080  33 C0				 XOR   AX,   AX
1   248	    0082  E8 0000e			 CALL  PUTSS
    249						 PUTLSC	 ULSTU	 ;  и
1   250	    0085  BE 008Er			 LEA   SI,   ULSTU
1   251	    0088  E8 0000e			 CALL  SLEN
1   252	    008B  B9 0050			 MOV   CX, 80
1   253	    008E  2B C8				 SUB   CX, AX
1   254	    0090  D1 F9				 SAR   CX,  1
1   255	    0092  74 09	90 90			 JZ    ??0003
1   256	    0096  B0 20			 ??0002: MOV   AL, ' '
1   257	    0098  E8 0000e			 CALL  PUTC
1   258	    009B  E2 F9				 LOOP  ??0002
1   259	    009D			 ??0003: PUTLS ULSTU
2   260	    009D  33 C0				 XOR   AX,   AX
2   261	    009F  BE 008Er			 LEA   SI,   ULSTU
2   262	    00A2  8B 16	0242r			 MOV   DX,   PAUSE
2   263	    00A6  8B 0E	0244r			 MOV   CX,   PAUSE+2
2   264	    00AA  E8 0000e			 CALL  PUTSS
    265						 PUTL	 EMPTYS
1   266	    00AD  BE 01F9r			 LEA   SI,   EMPTYS
1   267	    00B0  33 C9				 XOR   CX,   CX
1   268	    00B2  33 D2				 XOR   DX,   DX
1   269	    00B4  33 C0				 XOR   AX,   AX
1   270	    00B6  E8 0000e			 CALL  PUTSS
    271						 PUTLSC	 DEPT	 ;   последующие
1   272	    00B9  BE 00C5r			 LEA   SI,   DEPT
1   273	    00BC  E8 0000e			 CALL  SLEN
1   274	    00BF  B9 0050			 MOV   CX, 80
1   275	    00C2  2B C8				 SUB   CX, AX
1   276	    00C4  D1 F9				 SAR   CX,  1
1   277	    00C6  74 09	90 90			 JZ    ??0005
1   278	    00CA  B0 20			 ??0004: MOV   AL, ' '
1   279	    00CC  E8 0000e			 CALL  PUTC
1   280	    00CF  E2 F9				 LOOP  ??0004
1   281	    00D1			 ??0005: PUTLS DEPT
2   282	    00D1  33 C0				 XOR   AX,   AX
2   283	    00D3  BE 00C5r			 LEA   SI,   DEPT
2   284	    00D6  8B 16	0242r			 MOV   DX,   PAUSE
2   285	    00DA  8B 0E	0244r			 MOV   CX,   PAUSE+2
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 6
mopl1.asm



2   286	    00DE  E8 0000e			 CALL  PUTSS
    287						 PUTL	 EMPTYS
1   288	    00E1  BE 01F9r			 LEA   SI,   EMPTYS
1   289	    00E4  33 C9				 XOR   CX,   CX
1   290	    00E6  33 D2				 XOR   DX,   DX
1   291	    00E8  33 C0				 XOR   AX,   AX
1   292	    00EA  E8 0000e			 CALL  PUTSS
    293						 PUTLSC	 MOP	 ;    строки
1   294	    00ED  BE 00E6r			 LEA   SI,   MOP
1   295	    00F0  E8 0000e			 CALL  SLEN
1   296	    00F3  B9 0050			 MOV   CX, 80
1   297	    00F6  2B C8				 SUB   CX, AX
1   298	    00F8  D1 F9				 SAR   CX,  1
1   299	    00FA  74 09	90 90			 JZ    ??0007
1   300	    00FE  B0 20			 ??0006: MOV   AL, ' '
1   301	    0100  E8 0000e			 CALL  PUTC
1   302	    0103  E2 F9				 LOOP  ??0006
1   303	    0105			 ??0007: PUTLS MOP
2   304	    0105  33 C0				 XOR   AX,   AX
2   305	    0107  BE 00E6r			 LEA   SI,   MOP
2   306	    010A  8B 16	0242r			 MOV   DX,   PAUSE
2   307	    010E  8B 0E	0244r			 MOV   CX,   PAUSE+2
2   308	    0112  E8 0000e			 CALL  PUTSS
    309						 PUTL	 EMPTYS
1   310	    0115  BE 01F9r			 LEA   SI,   EMPTYS
1   311	    0118  33 C9				 XOR   CX,   CX
1   312	    011A  33 D2				 XOR   DX,   DX
1   313	    011C  33 C0				 XOR   AX,   AX
1   314	    011E  E8 0000e			 CALL  PUTSS
    315						 PUTLSC	 LABR	 ;     заставки
1   316	    0121  BE 0110r			 LEA   SI,   LABR
1   317	    0124  E8 0000e			 CALL  SLEN
1   318	    0127  B9 0050			 MOV   CX, 80
1   319	    012A  2B C8				 SUB   CX, AX
1   320	    012C  D1 F9				 SAR   CX,  1
1   321	    012E  74 09	90 90			 JZ    ??0009
1   322	    0132  B0 20			 ??0008: MOV   AL, ' '
1   323	    0134  E8 0000e			 CALL  PUTC
1   324	    0137  E2 F9				 LOOP  ??0008
1   325	    0139			 ??0009: PUTLS LABR
2   326	    0139  33 C0				 XOR   AX,   AX
2   327	    013B  BE 0110r			 LEA   SI,   LABR
2   328	    013E  8B 16	0242r			 MOV   DX,   PAUSE
2   329	    0142  8B 0E	0244r			 MOV   CX,   PAUSE+2
2   330	    0146  E8 0000e			 CALL  PUTSS
    331						 PUTL	 EMPTYS
1   332	    0149  BE 01F9r			 LEA   SI,   EMPTYS
1   333	    014C  33 C9				 XOR   CX,   CX
1   334	    014E  33 D2				 XOR   DX,   DX
1   335	    0150  33 C0				 XOR   AX,   AX
1   336	    0152  E8 0000e			 CALL  PUTSS
    337						 ; приветствие
    338						 PUTLSC	 SNAME	 ; ФИО студента
1   339	    0155  BE 01FCr			 LEA   SI,   SNAME
1   340	    0158  E8 0000e			 CALL  SLEN
1   341	    015B  B9 0050			 MOV   CX, 80
1   342	    015E  2B C8				 SUB   CX, AX
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 7
mopl1.asm



1   343	    0160  D1 F9				 SAR   CX,  1
1   344	    0162  74 09	90 90			 JZ    ??000B
1   345	    0166  B0 20			 ??000A: MOV   AL, ' '
1   346	    0168  E8 0000e			 CALL  PUTC
1   347	    016B  E2 F9				 LOOP  ??000A
1   348	    016D			 ??000B: PUTLS SNAME
2   349	    016D  33 C0				 XOR   AX,   AX
2   350	    016F  BE 01FCr			 LEA   SI,   SNAME
2   351	    0172  8B 16	0242r			 MOV   DX,   PAUSE
2   352	    0176  8B 0E	0244r			 MOV   CX,   PAUSE+2
2   353	    017A  E8 0000e			 CALL  PUTSS
    354						 PUTL	 EMPTYS
1   355	    017D  BE 01F9r			 LEA   SI,   EMPTYS
1   356	    0180  33 C9				 XOR   CX,   CX
1   357	    0182  33 D2				 XOR   DX,   DX
1   358	    0184  33 C0				 XOR   AX,   AX
1   359	    0186  E8 0000e			 CALL  PUTSS
    360						 ; разделительная черта
    361						 PUTL	 SLINE
1   362	    0189  BE 0000r			 LEA   SI,   SLINE
1   363	    018C  33 C9				 XOR   CX,   CX
1   364	    018E  33 D2				 XOR   DX,   DX
1   365	    0190  33 C0				 XOR   AX,   AX
1   366	    0192  E8 0000e			 CALL  PUTSS
    367						 ; ИЗМЕРЕНИЕ ВРЕМЕНИ ЗАКОНЧИТЬ ЗДЕСЬ
    368						 DURAT		 ; подсчет затраченного	времени
1   369	    0195  0F 31				 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1   370	    0197  66| 5B			 POP	 EBX
1   371	    0199  66| 2B C3			 SUB	 EAX,	 EBX
1   372	    019C  66| 5B			 POP	 EBX
1   373	    019E  66| 1B D3			 SBB	 EDX,	 EBX
    374						 ; Преобразование числа	тиков в	строку и вывод
    375	    01A1  BF 0246r			 LEA	 DI,	 TI
    376	    01A4  E8 0000e			 CALL	 UTOA10
    377						 PUTL	 TACTS
1   378	    01A7  BE 01AFr			 LEA   SI,   TACTS
1   379	    01AA  33 C9				 XOR   CX,   CX
1   380	    01AC  33 D2				 XOR   DX,   DX
1   381	    01AE  33 C0				 XOR   AX,   AX
1   382	    01B0  E8 0000e			 CALL  PUTSS
    383						 PUTL	 TI	 ; вывод числа тактов
1   384	    01B3  BE 0246r			 LEA   SI,   TI
1   385	    01B6  33 C9				 XOR   CX,   CX
1   386	    01B8  33 D2				 XOR   DX,   DX
1   387	    01BA  33 C0				 XOR   AX,   AX
1   388	    01BC  E8 0000e			 CALL  PUTSS
    389						 ; обработка команды
    390						 PUTL	 REQ1
1   391	    01BF  BE 0134r			 LEA   SI,   REQ1
1   392	    01C2  33 C9				 XOR   CX,   CX
1   393	    01C4  33 D2				 XOR   DX,   DX
1   394	    01C6  33 C0				 XOR   AX,   AX
1   395	    01C8  E8 0000e			 CALL  PUTSS
    396					 ;------Вывод своих строк с действиями -------------------
    397						 PUTL	 REQ2
1   398	    01CB  BE 0180r			 LEA   SI,   REQ2
1   399	    01CE  33 C9				 XOR   CX,   CX
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 8
mopl1.asm



1   400	    01D0  33 D2				 XOR   DX,   DX
1   401	    01D2  33 C0				 XOR   AX,   AX
1   402	    01D4  E8 0000e			 CALL  PUTSS
    403					 ;--------------------------------------------------------
    404	    01D7  E8 0000e			 CALL	 GETCH
    405	    01DA  3C 2D				 CMP	 AL,	 '-'	; удлиннять задержку?
    406	    01DC  75 09	90 90			 JNE	 CMINUS
    407	    01E0  FF 06	0244r			 INC	 PAUSE+2	; добавить 65536 мкс
    408	    01E4  E9 FE40			 JMP	 @@L
    409	    01E7  3C 2B			 CMINUS: CMP	 AL,	 '+'	; укорачивать задержку?
    410	    01E9  75 12	90 90			 JNE	 CEXIT
    411	    01ED  83 3E	0244r 00		 CMP	 WORD PTR PAUSE+2, 0
    412	    01F2  74 06	90 90			 JE	 BACK
    413	    01F6  FF 0E	0244r			 DEC	 PAUSE+2	; убавить 65536	мкс
    414	    01FA  E9 FE2A		 BACK:	 JMP	 @@L
    415	    01FD  3C 66			 CEXIT:	 CMP	 AL,	 'f'
    416	    01FF  75 05	90 90			 JNE	 CFUNC
    417	    0203  EB 11	90			 JMP func
    418	    0206  3C 1B			 CFUNC:	CMP	 AL,	 CHESC
    419	    0208  0F 84	009C			 JE	 @@E
    420	    020C  84 C0				 TEST	 AL,	 AL
    421	    020E  75 EA				 JNE	 BACK
    422	    0210  E8 0000e			 CALL	 GETCH
    423	    0213  E9 FE11			 JMP	 @@L
    424						 ; Выход из программы
    425	    0216			 func:
    426						 PUTL N
1   427	    0216  BE 01C7r			 LEA   SI,   N
1   428	    0219  33 C9				 XOR   CX,   CX
1   429	    021B  33 D2				 XOR   DX,   DX
1   430	    021D  33 C0				 XOR   AX,   AX
1   431	    021F  E8 0000e			 CALL  PUTSS
    432	    0222  E8 0000e			 CALL GETCH
    433	    0225  2C 30				 SUB AL, 30h ;введение позиции бита
    434	    0227  8A C8				 mov cl, AL  ;кол-во сдвигов
    435	    0229  66| D3 CB			 ror ebx, cl ;сдвиг под	 нужный	бит
    436						 PUTL NEWLINE
1   437	    022C  BE 017Er			 LEA   SI,   NEWLINE
1   438	    022F  33 C9				 XOR   CX,   CX
1   439	    0231  33 D2				 XOR   DX,   DX
1   440	    0233  33 C0				 XOR   AX,   AX
1   441	    0235  E8 0000e			 CALL  PUTSS
    442						 PUTL X
1   443	    0238  BE 01A5r			 LEA   SI,   X
1   444	    023B  33 C9				 XOR   CX,   CX
1   445	    023D  33 D2				 XOR   DX,   DX
1   446	    023F  33 C0				 XOR   AX,   AX
1   447	    0241  E8 0000e			 CALL  PUTSS
    448	    0244  E8 0000e			 CALL GETCH
    449						 PUTL NEWLINE
1   450	    0247  BE 017Er			 LEA   SI,   NEWLINE
1   451	    024A  33 C9				 XOR   CX,   CX
1   452	    024C  33 D2				 XOR   DX,   DX
1   453	    024E  33 C0				 XOR   AX,   AX
1   454	    0250  E8 0000e			 CALL  PUTSS
    455	    0253  2C 30				 SUB AL, 30h ;запись значения
    456	    0255  02 D8				 add bl, AL	 ;прибавление значения
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 9
mopl1.asm



    457	    0257  B0 32				 mov al, 32h ;длина ebx
    458	    0259  2A C1				 sub al, cl  ;получем значение для возвращения числа на	исходную позицию
    459	    025B  8A C8				 mov cl, al	 ;перемещаем значение в	cl
    460	    025D  66| D3 CB			 ror ebx, cl ;сдвигаем в начальное состояние
    461	    0260  EB 01	90			 JMP CHOICE
    462	    0263			 CHOICE:
    463	    0263  E8 0013			 call OutBin
    464						 PUTL Choc
1   465	    0266  BE 0129r			 LEA   SI,   Choc
1   466	    0269  33 C9				 XOR   CX,   CX
1   467	    026B  33 D2				 XOR   DX,   DX
1   468	    026D  33 C0				 XOR   AX,   AX
1   469	    026F  E8 0000e			 CALL  PUTSS
    470	    0272  E8 0000e			 CALL GETCH
    471	    0275  3C 79				 CMP	 al, 'y'
    472	    0277  75 9D				 JNE func
    473
    474	    0279			 OutBin	proc
    475	    0279  B1 32				 mov cl, 32h
    476	    027B			 Print_ebx:
    477	    027B  66| D1 CB			 ror ebx, 1
    478	    027E  72 15	90 90			 jc Print_ebx_1
    479						 PUTL O_0
1   480	    0282  BE 01ADr			 LEA   SI,   O_0
1   481	    0285  33 C9				 XOR   CX,   CX
1   482	    0287  33 D2				 XOR   DX,   DX
1   483	    0289  33 C0				 XOR   AX,   AX
1   484	    028B  E8 0000e			 CALL  PUTSS
    485	    028E  FE C9				 dec cl
    486	    0290  80 F9	00			 cmp cl, 0
    487	    0293  76 E6				 JBE Print_ebx
    488
    489	    0295			 Print_ebx_1:
    490	    0295  FE C9				 dec cl
    491						 PUTL O_1
1   492	    0297  BE 01ABr			 LEA   SI,   O_1
1   493	    029A  33 C9				 XOR   CX,   CX
1   494	    029C  33 D2				 XOR   DX,   DX
1   495	    029E  33 C0				 XOR   AX,   AX
1   496	    02A0  E8 0000e			 CALL  PUTSS
    497	    02A3  80 F9	00			 cmp cl, 0
    498	    02A6  76 D3				 JBE Print_ebx
    499
    500	    02A8			 OutBin	endp
    501
    502	    02A8			 @@E:	 EXIT
1   503	    02A8  B4 4C				 MOV	 AH, FUEXIT
1   504	    02AA  B0 00				 MOV	 AL, 0
1   505	    02AC  CD 21				 INT	 DOSFU
    506						 EXTRN	 PUTSS:	 NEAR
    507						 EXTRN	 PUTC:	 NEAR
    508						 EXTRN	 GETCH:	 NEAR
    509						 EXTRN	 GETS:	 NEAR
    510						 EXTRN	 SLEN:	 NEAR
    511						 EXTRN	 UTOA10: NEAR
    512						 END	 BEGIN
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 10
Symbol Table




Symbol Name			  Type	 Value

??0000				  Near	 _TEXT:0062
??0001				  Near	 _TEXT:0069
??0002				  Near	 _TEXT:0096
??0003				  Near	 _TEXT:009D
??0004				  Near	 _TEXT:00CA
??0005				  Near	 _TEXT:00D1
??0006				  Near	 _TEXT:00FE
??0007				  Near	 _TEXT:0105
??0008				  Near	 _TEXT:0132
??0009				  Near	 _TEXT:0139
??000A				  Near	 _TEXT:0166
??000B				  Near	 _TEXT:016D
??DATE				  Text	 "02/09/22"
??FILENAME			  Text	 "mopl1	  "
??TIME				  Text	 "13:16:47"
??VERSION			  Number 030A
@32BIT				  Text	 0
@@E				  Near	 _TEXT:02A8
@@L				  Near	 _TEXT:0027
@CODE				  Text	 _TEXT
@CODESIZE			  Text	 0
@CPU				  Text	 0F0FH
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 MOPL1
@INTERFACE			  Text	 00H
@MODEL				  Text	 2
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BACK				  Near	 _TEXT:01FA
BEGIN				  Near	 _TEXT:0000
BUF				  Byte	 DGROUP:01FA
BUFLEN				  Number 0046
CEXIT				  Near	 _TEXT:01FD
CFUNC				  Near	 _TEXT:0206
CHCOMMA				  Number 0060
CHCR				  Number 000D
CHESC				  Number 001B
CHLF				  Number 000A
CHOC				  Byte	 DGROUP:0129
CHOICE				  Near	 _TEXT:0263
CHSEP				  Number 003D
CMINUS				  Near	 _TEXT:01E7
DEPT				  Byte	 DGROUP:00C5
DOSFU				  Number 0021
EMPTYS				  Byte	 DGROUP:01F9
FUEXIT				  Number 004C
FUGETCH				  Number 0008
FUGETS				  Number 000A
FUNC				  Near	 _TEXT:0216
FUPUTC				  Number 0002
GETCH				  Near	 _TEXT:---- Extern
GETS				  Near	 _TEXT:---- Extern
Turbo Assembler	 Version 3.1	    02/09/22 13:16:48	    Page 11
Symbol Table



LABR				  Byte	 DGROUP:0110
LENNUM				  Number 0012
LENPACK				  Number 0009
LENS				  Byte	 DGROUP:01FB
MINIS				  Byte	 DGROUP:005F
MOP				  Byte	 DGROUP:00E6
N				  Byte	 DGROUP:01C7
NEWLINE				  Byte	 DGROUP:017E
OUTBIN				  Near	 _TEXT:0279
O_0				  Byte	 DGROUP:01AD
O_1				  Byte	 DGROUP:01AB
PAUSE				  Word	 DGROUP:0242
PAUSE_H				  Number 0000
PAUSE_L				  Number 0000
PRINT_EBX			  Near	 _TEXT:027B
PRINT_EBX_1			  Near	 _TEXT:0295
PUTC				  Near	 _TEXT:---- Extern
PUTSS				  Near	 _TEXT:---- Extern
REQ				  Byte	 DGROUP:004F
REQ1				  Byte	 DGROUP:0134
REQ2				  Byte	 DGROUP:0180
SLEN				  Near	 _TEXT:---- Extern
SLINE				  Byte	 DGROUP:0000
SNAME				  Byte	 DGROUP:01FC
TACTS				  Byte	 DGROUP:01AF
TI				  Byte	 DGROUP:0246
ULSTU				  Byte	 DGROUP:008E
UTOA10				  Near	 _TEXT:---- Extern
X				  Byte	 DGROUP:01A5
XNUM				  Byte	 DGROUP:01CC
Y				  Byte	 DGROUP:01E0
YNUM				  Byte	 DGROUP:01E5

Macro Name

DURAT
EXIT
FIXTIME
PUTL
PUTLS
PUTLSC

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  STACK				  16  0200 Para	  Stack	  STACK
  _DATA				  16  0262 Word	  Public  DATA
_TEXT				  16  02AE Word	  Public  CODE
