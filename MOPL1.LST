Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 1
mopl1.asm



      1					 ;*******************************************************************************************
      2					 ********
      3					 ; MOPL1.ASM - учебный пример для выполнения
      4					 ; лабораторной	работы N1 по машинно-ориентированному программированию
      5					 ;*******************************************************************************************
      6					 ********
      7	    0000				 .MODEL	SMALL
      8	    0000				 .STACK	200h
      9						 .386
     10					 ;	 Используются декларации констант и макросов
     11						 INCLUDE MOPL1.INC
1    12					 ;*********************************************************
1    13					 ; Константы для учебного примера лабораторной работы N	1  *
1    14					 ; по МОП.						   *
1    15					 ;*********************************************************
1    16
1    17		  =001B			 CHESC	 = 1Bh
1    18		  =000D			 CHCR	 = 13
1    19		  =003D			 CHSEP	 = '='
1    20		  =0060			 CHCOMMA = '`'
1    21		  =000A			 CHLF	 = 10
1    22		  =0021			 DOSFU	 = 21h
1    23		  =0002			 FUPUTC	 = 2
1    24		  =0008			 FUGETCH = 8
1    25		  =000A			 FUGETS	 = 0Ah
1    26		  =004C			 FUEXIT	 = 4Ch
1    27		  =0000			 PAUSE_L = 0000	 ; Младшее слово стартового значения паузы
1    28		  =0000			 PAUSE_H = 0	 ; Старшее слово
1    29		  =0012			 LENNUM	 = 18	 ; Число символов в строке десятичного числа
1    30		  =0009			 LENPACK = 9	 ; Упаковонное в два раза короче
1    31
1    32
     33						 INCLUDE MOPL1.MAC
1    34					 ;*********************************************************
1    35					 ; Макросы для учебного	примера	лабораторной работы N 1	   *
1    36					 ; по МОП.						   *
1    37					 ;*********************************************************
1    38
1    39					 ; Макрос вывода строки	LINE
1    40					 PUTL	 MACRO LINE
1    41						 LEA   SI,   LINE
1    42						 XOR   CX,   CX
1    43						 XOR   DX,   DX
1    44						 XOR   AX,   AX
1    45						 CALL  PUTSS
1    46						 ENDM
1    47
1    48					 ; Макрос вывода строки	LINE с задержкой PAUSE
1    49					 PUTLS	 MACRO LINE
1    50						 XOR   AX,   AX
1    51						 LEA   SI,   LINE
1    52						 MOV   DX,   PAUSE
1    53						 MOV   CX,   PAUSE+2
1    54						 CALL  PUTSS
1    55						 ENDM
1    56
1    57					 ; Как и PUTLS,	но с центрированием посередине
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 2
mopl1.asm



1    58					 PUTLSC	 MACRO LINE
1    59						 LOCAL LO, NOMARG
1    60						 LEA   SI,   LINE
1    61						 CALL  SLEN
1    62						 MOV   CX, 80
1    63						 SUB   CX, AX
1    64						 SAR   CX,  1
1    65						 JZ    NOMARG
1    66					 LO:	 MOV   AL, ' '
1    67						 CALL  PUTC
1    68						 LOOP  LO
1    69					 NOMARG: PUTLS LINE
1    70						 ENDM
1    71
1    72					 ; Макрос фиксации начала измерения времени
1    73					 ; Заносит в стек младшее слово	числа тактов системных часов
1    74					 FIXTIME MACRO
1    75						 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1    76						 PUSH	 EDX
1    77						 PUSH	 EAX
1    78						 ENDM
1    79
1    80					 ; Макрос получения в <EDX,EAX>	числа тактов, прошедших	с последнего
1    81					 ; момента фиксации времени. Извлекает продукт FIXTIME из стека
1    82					 DURAT	 MACRO
1    83						 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1    84						 POP	 EBX
1    85						 SUB	 EAX,	 EBX
1    86						 POP	 EBX
1    87						 SBB	 EDX,	 EBX
1    88						 ENDM
1    89
1    90					 ; Макрос завершения программы
1    91					 EXIT	 MACRO
1    92						 MOV	 AH, FUEXIT
1    93						 MOV	 AL, 0
1    94						 INT	 DOSFU
1    95						 ENDM
1    96
     97
     98					 ; Декларации данных
     99	    0000				 .DATA
    100	    0000  4E*(3D) 00		 SLINE	 DB	 78 DUP	(CHSEP), 0
    101	    004F  46 69	6D 69 6C 69 79+	 REQ	 DB	 "Fimiliya I.O.: ",0FFh
    102		  61 20	49 2E 4F 2E 3A+
    103		  20 FF
    104	    005F  4D 49	4E 49 53 54 45+	 MINIS	 DB	 "MINISTERSTVO OBRAZOVANIYA ROSSIJSKOJ FEDERACII",0
    105		  52 53	54 56 4F 20 4F+
    106		  42 52	41 5A 4F 56 41+
    107		  4E 49	59 41 20 52 4F+
    108		  53 53	49 4A 53 4B 4F+
    109		  4A 20	46 45 44 45 52+
    110		  41 43	49 49 00
    111	    008E  55 4C	27 59 41 4E 4F+	 ULSTU	 DB	 "UL'YANOVSKIJ GOSUDARSTVENNYJ TEKHNICHESKIJ UNIVERSITET",0
    112		  56 53	4B 49 4A 20 47+
    113		  4F 53	55 44 41 52 53+
    114		  54 56	45 4E 4E 59 4A+
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 3
mopl1.asm



    115		  20 54	45 4B 48 4E 49+
    116		  43 48	45 53 4B 49 4A+
    117		  20 55	4E 49 56 45 52+
    118		  53 49	54 45 54 00
    119	    00C5  4B 61	66 65 64 72 61+	 DEPT	 DB	 "Kafedra vychislitel'noj tekhniki",0
    120		  20 76	79 63 68 69 73+
    121		  6C 69	74 65 6C 27 6E+
    122		  6F 6A	20 74 65 6B 68+
    123		  6E 69	6B 69 00
    124	    00E6  4D 61	73 68 69 6E 6E+	 MOP	 DB	 "Mashinno-orientirovannoe programmirovanie",0
    125		  6F 2D	6F 72 69 65 6E+
    126		  74 69	72 6F 76 61 6E+
    127		  6E 6F	65 20 70 72 6F+
    128		  67 72	61 6D 6D 69 72+
    129		  6F 76	61 6E 69 65 00
    130	    0110  4C 61	62 6F 72 61 74+	 LABR	 DB	 "Laboratornaya	rabota N 1",0
    131		  6F 72	6E 61 79 61 20+
    132		  72 61	62 6F 74 61 20+
    133		  4E 20	31 00
    134	    0129  43 61	6C 63 75 6C 61+	 Choc	 DB	 "Calculate?", 0
    135		  74 65	3F 00
    136	    0134  5A 61	6D 65 64 6C 69+	 REQ1	 DB	 "Zamedlit' vremya raboty v taktah(-), uskorit'	vremya raboty v	taktah (+), +
    137		  74 27	20 76 72 65 6D+	 ", 0
    138		  79 61	20 72 61 62 6F+
    139		  74 79	20 76 20 74 61+
    140		  6B 74	61 68 28 2D 29+
    141		  2C 20	75 73 6B 6F 72+
    142		  69 74	27 20 76 72 65+
    143		  6D 79	61 20 72 61 62+
    144		  6F 74	79 20 76 20 74+
    145		  61 6B	74 61 68 20 28+
    146		  2B 29	2C 00
    147	    017E  20 00			 NEWLINE DB " ", 0
    148					 ;-------------	Новые переменные							    +
    149					 ------------------------------------------------------------------
    150	    0180  76 79	63 68 69 73 6C+	 REQ2	 DB	 "vychislit' funkciyu (f), vyjti(ESC)?", 0
    151		  69 74	27 20 66 75 6E+
    152		  6B 63	69 79 75 20 28+
    153		  66 29	2C 20 76 79 6A+
    154		  74 69	28 45 53 43 29+
    155		  3F 00
    156					 ;-------------------------------------------------------------------------------------------
    157					 ------
    158	    01A5  58 6E	20 3D 20 FF	 X DB "Xn = ",0FFh
    159	    01AB  31 FF			 O_1 DB	"1", 0FFh
    160	    01AD  30 FF			 O_0 DB	"0", 0FFh
    161	    01AF  82 E0	A5 AC EF 20 E0+	 TACTS	 DB	 "Время	работы в тактах: ",0
    162		  A0 A1	AE E2 EB 20 A2+
    163		  20 E2	A0 AA E2 A0 E5+
    164		  3A 20	00
    165	    01C7  4E 20	3D 20 FF	 N DB "N = ",0FFh
    166	    01CC  ????????		 XNUM  DD ?
    167	    01D0  00 00	00 00		 Xn DB 0,0,0,0
    168	    01D4  59 20	3D 20 FF	 Y DB "Y = ",0FFh
    169	    01D9  ????			 YNUM  DW ?
    170	    01DB  00			 EMPTYS	 DB	 0
    171		  =0046			 BUFLEN	= 70
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 4
mopl1.asm



    172	    01DC  46			 BUF	 DB	 BUFLEN
    173	    01DD  ??			 LENS	 DB	 ?
    174	    01DE  46*(00)		 SNAME	 DB	 BUFLEN	DUP (0)
    175	    0224  0000 0000		 PAUSE	 DW	 0, 0 ;	младшее	и старшее слова	задержки при выводе строки
    176	    0228  1B*(??) 00		 TI	 DB	 LENNUM+LENNUM/2 DUP(?), 0 ; строка вывода числа тактов
    177										   ; запас для разделительных "`"
    178
    179					 ;========================= Программа =========================
    180	    0244				 .CODE
    181					 ; Макрос заполнения строки LINE от позиции POS	содержимым CNT объектов,
    182					 ; адресуемых адресом ADR при ширине поля вывода WFLD
    183	    0000			 BEGIN	 LABEL	 NEAR
    184						 ; инициализация сегментного регистра
    185	    0000  B8 0000s			 MOV	 AX,	 @DATA
    186	    0003  8E D8				 MOV	 DS,	 AX
    187						 ; инициализация задержки
    188	    0005  C7 06	0224r 0000		 MOV	 PAUSE,	 PAUSE_L
    189	    000B  C7 06	0226r 0000		 MOV	 PAUSE+2,PAUSE_H
    190						 PUTLS	 REQ	 ; запрос имени
1   191	    0011  33 C0				 XOR   AX,   AX
1   192	    0013  BE 004Fr			 LEA   SI,   REQ
1   193	    0016  8B 16	0224r			 MOV   DX,   PAUSE
1   194	    001A  8B 0E	0226r			 MOV   CX,   PAUSE+2
1   195	    001E  E8 0000e			 CALL  PUTSS
    196						 ; ввод	имени
    197	    0021  BA 01DCr			 LEA	 DX,	 BUF
    198	    0024  E8 0000e			 CALL	 GETS
    199	    0027			 @@L:	 ; циклический процесс повторения вывода заставки
    200						 ; вывод заставки
    201						 ; ИЗМЕРЕНИЕ ВРЕМЕНИ НАЧАТЬ ЗДЕСЬ
    202						 FIXTIME
1   203	    0027  0F 31				 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1   204	    0029  66| 52			 PUSH	 EDX
1   205	    002B  66| 50			 PUSH	 EAX
    206						 PUTL	 EMPTYS
1   207	    002D  BE 01DBr			 LEA   SI,   EMPTYS
1   208	    0030  33 C9				 XOR   CX,   CX
1   209	    0032  33 D2				 XOR   DX,   DX
1   210	    0034  33 C0				 XOR   AX,   AX
1   211	    0036  E8 0000e			 CALL  PUTSS
    212						 PUTL	 SLINE	 ; разделительная черта
1   213	    0039  BE 0000r			 LEA   SI,   SLINE
1   214	    003C  33 C9				 XOR   CX,   CX
1   215	    003E  33 D2				 XOR   DX,   DX
1   216	    0040  33 C0				 XOR   AX,   AX
1   217	    0042  E8 0000e			 CALL  PUTSS
    218						 PUTL	 EMPTYS
1   219	    0045  BE 01DBr			 LEA   SI,   EMPTYS
1   220	    0048  33 C9				 XOR   CX,   CX
1   221	    004A  33 D2				 XOR   DX,   DX
1   222	    004C  33 C0				 XOR   AX,   AX
1   223	    004E  E8 0000e			 CALL  PUTSS
    224						 PUTLSC	 MINIS	 ; первая
1   225	    0051  BE 005Fr			 LEA   SI,   MINIS
1   226	    0054  E8 0000e			 CALL  SLEN
1   227	    0057  B9 0050			 MOV   CX, 80
1   228	    005A  2B C8				 SUB   CX, AX
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 5
mopl1.asm



1   229	    005C  D1 F9				 SAR   CX,  1
1   230	    005E  74 09	90 90			 JZ    ??0001
1   231	    0062  B0 20			 ??0000: MOV   AL, ' '
1   232	    0064  E8 0000e			 CALL  PUTC
1   233	    0067  E2 F9				 LOOP  ??0000
1   234	    0069			 ??0001: PUTLS MINIS
2   235	    0069  33 C0				 XOR   AX,   AX
2   236	    006B  BE 005Fr			 LEA   SI,   MINIS
2   237	    006E  8B 16	0224r			 MOV   DX,   PAUSE
2   238	    0072  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   239	    0076  E8 0000e			 CALL  PUTSS
    240						 PUTL	 EMPTYS
1   241	    0079  BE 01DBr			 LEA   SI,   EMPTYS
1   242	    007C  33 C9				 XOR   CX,   CX
1   243	    007E  33 D2				 XOR   DX,   DX
1   244	    0080  33 C0				 XOR   AX,   AX
1   245	    0082  E8 0000e			 CALL  PUTSS
    246						 PUTLSC	 ULSTU	 ;  и
1   247	    0085  BE 008Er			 LEA   SI,   ULSTU
1   248	    0088  E8 0000e			 CALL  SLEN
1   249	    008B  B9 0050			 MOV   CX, 80
1   250	    008E  2B C8				 SUB   CX, AX
1   251	    0090  D1 F9				 SAR   CX,  1
1   252	    0092  74 09	90 90			 JZ    ??0003
1   253	    0096  B0 20			 ??0002: MOV   AL, ' '
1   254	    0098  E8 0000e			 CALL  PUTC
1   255	    009B  E2 F9				 LOOP  ??0002
1   256	    009D			 ??0003: PUTLS ULSTU
2   257	    009D  33 C0				 XOR   AX,   AX
2   258	    009F  BE 008Er			 LEA   SI,   ULSTU
2   259	    00A2  8B 16	0224r			 MOV   DX,   PAUSE
2   260	    00A6  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   261	    00AA  E8 0000e			 CALL  PUTSS
    262						 PUTL	 EMPTYS
1   263	    00AD  BE 01DBr			 LEA   SI,   EMPTYS
1   264	    00B0  33 C9				 XOR   CX,   CX
1   265	    00B2  33 D2				 XOR   DX,   DX
1   266	    00B4  33 C0				 XOR   AX,   AX
1   267	    00B6  E8 0000e			 CALL  PUTSS
    268						 PUTLSC	 DEPT	 ;   последующие
1   269	    00B9  BE 00C5r			 LEA   SI,   DEPT
1   270	    00BC  E8 0000e			 CALL  SLEN
1   271	    00BF  B9 0050			 MOV   CX, 80
1   272	    00C2  2B C8				 SUB   CX, AX
1   273	    00C4  D1 F9				 SAR   CX,  1
1   274	    00C6  74 09	90 90			 JZ    ??0005
1   275	    00CA  B0 20			 ??0004: MOV   AL, ' '
1   276	    00CC  E8 0000e			 CALL  PUTC
1   277	    00CF  E2 F9				 LOOP  ??0004
1   278	    00D1			 ??0005: PUTLS DEPT
2   279	    00D1  33 C0				 XOR   AX,   AX
2   280	    00D3  BE 00C5r			 LEA   SI,   DEPT
2   281	    00D6  8B 16	0224r			 MOV   DX,   PAUSE
2   282	    00DA  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   283	    00DE  E8 0000e			 CALL  PUTSS
    284						 PUTL	 EMPTYS
1   285	    00E1  BE 01DBr			 LEA   SI,   EMPTYS
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 6
mopl1.asm



1   286	    00E4  33 C9				 XOR   CX,   CX
1   287	    00E6  33 D2				 XOR   DX,   DX
1   288	    00E8  33 C0				 XOR   AX,   AX
1   289	    00EA  E8 0000e			 CALL  PUTSS
    290						 PUTLSC	 MOP	 ;    строки
1   291	    00ED  BE 00E6r			 LEA   SI,   MOP
1   292	    00F0  E8 0000e			 CALL  SLEN
1   293	    00F3  B9 0050			 MOV   CX, 80
1   294	    00F6  2B C8				 SUB   CX, AX
1   295	    00F8  D1 F9				 SAR   CX,  1
1   296	    00FA  74 09	90 90			 JZ    ??0007
1   297	    00FE  B0 20			 ??0006: MOV   AL, ' '
1   298	    0100  E8 0000e			 CALL  PUTC
1   299	    0103  E2 F9				 LOOP  ??0006
1   300	    0105			 ??0007: PUTLS MOP
2   301	    0105  33 C0				 XOR   AX,   AX
2   302	    0107  BE 00E6r			 LEA   SI,   MOP
2   303	    010A  8B 16	0224r			 MOV   DX,   PAUSE
2   304	    010E  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   305	    0112  E8 0000e			 CALL  PUTSS
    306						 PUTL	 EMPTYS
1   307	    0115  BE 01DBr			 LEA   SI,   EMPTYS
1   308	    0118  33 C9				 XOR   CX,   CX
1   309	    011A  33 D2				 XOR   DX,   DX
1   310	    011C  33 C0				 XOR   AX,   AX
1   311	    011E  E8 0000e			 CALL  PUTSS
    312						 PUTLSC	 LABR	 ;     заставки
1   313	    0121  BE 0110r			 LEA   SI,   LABR
1   314	    0124  E8 0000e			 CALL  SLEN
1   315	    0127  B9 0050			 MOV   CX, 80
1   316	    012A  2B C8				 SUB   CX, AX
1   317	    012C  D1 F9				 SAR   CX,  1
1   318	    012E  74 09	90 90			 JZ    ??0009
1   319	    0132  B0 20			 ??0008: MOV   AL, ' '
1   320	    0134  E8 0000e			 CALL  PUTC
1   321	    0137  E2 F9				 LOOP  ??0008
1   322	    0139			 ??0009: PUTLS LABR
2   323	    0139  33 C0				 XOR   AX,   AX
2   324	    013B  BE 0110r			 LEA   SI,   LABR
2   325	    013E  8B 16	0224r			 MOV   DX,   PAUSE
2   326	    0142  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   327	    0146  E8 0000e			 CALL  PUTSS
    328						 PUTL	 EMPTYS
1   329	    0149  BE 01DBr			 LEA   SI,   EMPTYS
1   330	    014C  33 C9				 XOR   CX,   CX
1   331	    014E  33 D2				 XOR   DX,   DX
1   332	    0150  33 C0				 XOR   AX,   AX
1   333	    0152  E8 0000e			 CALL  PUTSS
    334						 ; приветствие
    335						 PUTLSC	 SNAME	 ; ФИО студента
1   336	    0155  BE 01DEr			 LEA   SI,   SNAME
1   337	    0158  E8 0000e			 CALL  SLEN
1   338	    015B  B9 0050			 MOV   CX, 80
1   339	    015E  2B C8				 SUB   CX, AX
1   340	    0160  D1 F9				 SAR   CX,  1
1   341	    0162  74 09	90 90			 JZ    ??000B
1   342	    0166  B0 20			 ??000A: MOV   AL, ' '
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 7
mopl1.asm



1   343	    0168  E8 0000e			 CALL  PUTC
1   344	    016B  E2 F9				 LOOP  ??000A
1   345	    016D			 ??000B: PUTLS SNAME
2   346	    016D  33 C0				 XOR   AX,   AX
2   347	    016F  BE 01DEr			 LEA   SI,   SNAME
2   348	    0172  8B 16	0224r			 MOV   DX,   PAUSE
2   349	    0176  8B 0E	0226r			 MOV   CX,   PAUSE+2
2   350	    017A  E8 0000e			 CALL  PUTSS
    351						 PUTL	 EMPTYS
1   352	    017D  BE 01DBr			 LEA   SI,   EMPTYS
1   353	    0180  33 C9				 XOR   CX,   CX
1   354	    0182  33 D2				 XOR   DX,   DX
1   355	    0184  33 C0				 XOR   AX,   AX
1   356	    0186  E8 0000e			 CALL  PUTSS
    357						 ; разделительная черта
    358						 PUTL	 SLINE
1   359	    0189  BE 0000r			 LEA   SI,   SLINE
1   360	    018C  33 C9				 XOR   CX,   CX
1   361	    018E  33 D2				 XOR   DX,   DX
1   362	    0190  33 C0				 XOR   AX,   AX
1   363	    0192  E8 0000e			 CALL  PUTSS
    364						 ; ИЗМЕРЕНИЕ ВРЕМЕНИ ЗАКОНЧИТЬ ЗДЕСЬ
    365						 DURAT		 ; подсчет затраченного	времени
1   366	    0195  0F 31				 DB	 0Fh, 31h; Команда RDTSC чтения	счетчика тактов
1   367	    0197  66| 5B			 POP	 EBX
1   368	    0199  66| 2B C3			 SUB	 EAX,	 EBX
1   369	    019C  66| 5B			 POP	 EBX
1   370	    019E  66| 1B D3			 SBB	 EDX,	 EBX
    371						 ; Преобразование числа	тиков в	строку и вывод
    372	    01A1  BF 0228r			 LEA	 DI,	 TI
    373	    01A4  E8 0000e			 CALL	 UTOA10
    374						 PUTL	 TACTS
1   375	    01A7  BE 01AFr			 LEA   SI,   TACTS
1   376	    01AA  33 C9				 XOR   CX,   CX
1   377	    01AC  33 D2				 XOR   DX,   DX
1   378	    01AE  33 C0				 XOR   AX,   AX
1   379	    01B0  E8 0000e			 CALL  PUTSS
    380						 PUTL	 TI	 ; вывод числа тактов
1   381	    01B3  BE 0228r			 LEA   SI,   TI
1   382	    01B6  33 C9				 XOR   CX,   CX
1   383	    01B8  33 D2				 XOR   DX,   DX
1   384	    01BA  33 C0				 XOR   AX,   AX
1   385	    01BC  E8 0000e			 CALL  PUTSS
    386						 ; обработка команды
    387						 PUTL	 REQ1
1   388	    01BF  BE 0134r			 LEA   SI,   REQ1
1   389	    01C2  33 C9				 XOR   CX,   CX
1   390	    01C4  33 D2				 XOR   DX,   DX
1   391	    01C6  33 C0				 XOR   AX,   AX
1   392	    01C8  E8 0000e			 CALL  PUTSS
    393					 ;------Вывод своих строк с действиями -------------------
    394						 PUTL	 REQ2
1   395	    01CB  BE 0180r			 LEA   SI,   REQ2
1   396	    01CE  33 C9				 XOR   CX,   CX
1   397	    01D0  33 D2				 XOR   DX,   DX
1   398	    01D2  33 C0				 XOR   AX,   AX
1   399	    01D4  E8 0000e			 CALL  PUTSS
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 8
mopl1.asm



    400					 ;--------------------------------------------------------
    401	    01D7  E8 0000e			 CALL	 GETCH
    402	    01DA  3C 2D				 CMP	 AL,	 '-'	; удлиннять задержку?
    403	    01DC  75 09	90 90			 JNE	 CMINUS
    404	    01E0  FF 06	0226r			 INC	 PAUSE+2	; добавить 65536 мкс
    405	    01E4  E9 FE40			 JMP	 @@L
    406	    01E7  3C 2B			 CMINUS: CMP	 AL,	 '+'	; укорачивать задержку?
    407	    01E9  75 12	90 90			 JNE	 CEXIT
    408	    01ED  83 3E	0226r 00		 CMP	 WORD PTR PAUSE+2, 0
    409	    01F2  74 06	90 90			 JE	 BACK
    410	    01F6  FF 0E	0226r			 DEC	 PAUSE+2	; убавить 65536	мкс
    411	    01FA  E9 FE2A		 BACK:	 JMP	 @@L
    412	    01FD  3C 66			 CEXIT:	 CMP	 AL,	 'f'
    413	    01FF  75 10	90 90			 JNE	 CFUNC
    414	    0203  66| 33 DB			 xor ebx, ebx
    415	    0206  E8 0042			 call func
    416	    0209  66| 89 1E 01CCr		 mov XNUM, ebx
    417	    020E  EB 11	90			 jmp xn_input
    418
    419	    0211  3C 1B			 CFUNC:	CMP	 AL,	 CHESC
    420	    0213  0F 84	00D3			 JE	 @@E
    421	    0217  84 C0				 TEST	 AL,	 AL
    422	    0219  75 DF				 JNE	 BACK
    423	    021B  E8 0000e			 CALL	 GETCH
    424	    021E  E9 FE06			 JMP	 @@L
    425						 ; Выход из программы
    426
    427	    0221			 xn_input:
    428	    0221  33 C9				 xor cx, cx
    429	    0223  B9 0004			 mov cx, 4h
    430	    0226  66| 83 E3 1E			 and ebx, 11110b ;нужные биты оставляем	остальные зануляем
    431	    022A			 l1:
    432	    022A  D0 E3				 shl bl, 1; побитово заносим в cf x
    433	    022C  72 0E	90 90			 jc xn_1; если равен 1,	то прыгаем
    434	    0230  8B F1				 mov si, cx
    435	    0232  C6 84	01CFr 00		 mov Xn[si-1h],	0b
    436	    0237  E2 F1				 loopw l1
    437	    0239  EB 0D	90			 jmp calc
    438	    023C			 xn_1:
    439	    023C  8B F1				 mov si, cx
    440	    023E  C6 84	01CFr 01		 mov Xn[si-1h],	1b
    441	    0243  E2 E5				 loopw l1
    442	    0245  EB 01	90			 jmp calc
    443
    444	    0248			 calc:
    445	    0248  E9 009F			 jmp @@e
    446
    447
    448	    024B			 input proc ; ввод ebx по битово
    449	    024B			 func:
    450	    024B  E8 0066			 call OutBin
    451						 PUTL N
1   452	    024E  BE 01C7r			 LEA   SI,   N
1   453	    0251  33 C9				 XOR   CX,   CX
1   454	    0253  33 D2				 XOR   DX,   DX
1   455	    0255  33 C0				 XOR   AX,   AX
1   456	    0257  E8 0000e			 CALL  PUTSS
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 9
mopl1.asm



    457	    025A  E8 0000e			 CALL GETCH
    458	    025D  2C 30				 SUB AL, 30h ;введение позиции бита
    459	    025F  8A C8				 mov cl, AL  ;кол-во сдвигов
    460	    0261  66| D3 CB			 ror ebx, cl ;сдвиг под	 нужный	бит
    461	    0264  60				 pusha ;сохраняю cl
    462						 PUTL NEWLINE
1   463	    0265  BE 017Er			 LEA   SI,   NEWLINE
1   464	    0268  33 C9				 XOR   CX,   CX
1   465	    026A  33 D2				 XOR   DX,   DX
1   466	    026C  33 C0				 XOR   AX,   AX
1   467	    026E  E8 0000e			 CALL  PUTSS
    468						 PUTL X
1   469	    0271  BE 01A5r			 LEA   SI,   X
1   470	    0274  33 C9				 XOR   CX,   CX
1   471	    0276  33 D2				 XOR   DX,   DX
1   472	    0278  33 C0				 XOR   AX,   AX
1   473	    027A  E8 0000e			 CALL  PUTSS
    474	    027D  61				 popa
    475	    027E  E8 0000e			 CALL GETCH
    476	    0281  2C 30				 SUB AL, 30h ;запись значения
    477	    0283  02 D8				 add bl, AL	 ;прибавление значения
    478	    0285  B0 20				 mov al, 20h ;длина ebx
    479	    0287  2A C1				 sub al, cl  ;получем значение для возвращения числа на	исходную позицию
    480	    0289  8A C8				 mov cl, al	 ;перемещаем значение в	cl
    481	    028B  66| D3 CB			 ror ebx, cl ;сдвигаем в начальное состояние
    482						 PUTL NEWLINE
1   483	    028E  BE 017Er			 LEA   SI,   NEWLINE
1   484	    0291  33 C9				 XOR   CX,   CX
1   485	    0293  33 D2				 XOR   DX,   DX
1   486	    0295  33 C0				 XOR   AX,   AX
1   487	    0297  E8 0000e			 CALL  PUTSS
    488	    029A  EB 01	90			 JMP CHOICE
    489	    029D			 CHOICE:
    490	    029D  E8 0014			 call OutBin
    491						 PUTL Choc
1   492	    02A0  BE 0129r			 LEA   SI,   Choc
1   493	    02A3  33 C9				 XOR   CX,   CX
1   494	    02A5  33 D2				 XOR   DX,   DX
1   495	    02A7  33 C0				 XOR   AX,   AX
1   496	    02A9  E8 0000e			 CALL  PUTSS
    497	    02AC  E8 0000e			 CALL GETCH
    498	    02AF  3C 79				 CMP	 al, 'y'
    499	    02B1  75 98				 JNE func
    500	    02B3  C3				 ret
    501	    02B4			 input endp
    502
    503
    504	    02B4			 OutBin	proc ; процедура вывода	ebx по битово
    505	    02B4  33 C9				 xor cx, cx
    506	    02B6  B9 0020			 mov cx, 20h
    507	    02B9			 Print_ebx:
    508	    02B9  66| D1 C3			 rol ebx, 1
    509	    02BC  72 17	90 90			 jc Print_ebx_1
    510	    02C0  B4 02				 mov ah,02h
    511	    02C2  B2 30				 mov dl,'0'
    512	    02C4  CD 21				 int 21h
    513	    02C6  E2 F1				 loopw Print_ebx
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 10
mopl1.asm



    514						 PUTL NEWLINE
1   515	    02C8  BE 017Er			 LEA   SI,   NEWLINE
1   516	    02CB  33 C9				 XOR   CX,   CX
1   517	    02CD  33 D2				 XOR   DX,   DX
1   518	    02CF  33 C0				 XOR   AX,   AX
1   519	    02D1  E8 0000e			 CALL  PUTSS
    520	    02D4  C3				 ret
    521
    522	    02D5			 Print_ebx_1:
    523	    02D5  B4 02				 mov ah,02h
    524	    02D7  B2 31				 mov dl,'1'
    525	    02D9  CD 21				 int 21h
    526	    02DB  E2 DC				 loopw Print_ebx
    527						 PUTL NEWLINE
1   528	    02DD  BE 017Er			 LEA   SI,   NEWLINE
1   529	    02E0  33 C9				 XOR   CX,   CX
1   530	    02E2  33 D2				 XOR   DX,   DX
1   531	    02E4  33 C0				 XOR   AX,   AX
1   532	    02E6  E8 0000e			 CALL  PUTSS
    533	    02E9  C3				 ret
    534	    02EA			 OutBin	endp
    535
    536	    02EA			 @@E:	 EXIT
1   537	    02EA  B4 4C				 MOV	 AH, FUEXIT
1   538	    02EC  B0 00				 MOV	 AL, 0
1   539	    02EE  CD 21				 INT	 DOSFU
    540						 EXTRN	 PUTSS:	 NEAR
    541						 EXTRN	 PUTC:	 NEAR
    542						 EXTRN	 GETCH:	 NEAR
    543						 EXTRN	 GETS:	 NEAR
    544						 EXTRN	 SLEN:	 NEAR
    545						 EXTRN	 UTOA10: NEAR
    546						 END	 BEGIN
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 11
Symbol Table




Symbol Name			  Type	 Value

??0000				  Near	 _TEXT:0062
??0001				  Near	 _TEXT:0069
??0002				  Near	 _TEXT:0096
??0003				  Near	 _TEXT:009D
??0004				  Near	 _TEXT:00CA
??0005				  Near	 _TEXT:00D1
??0006				  Near	 _TEXT:00FE
??0007				  Near	 _TEXT:0105
??0008				  Near	 _TEXT:0132
??0009				  Near	 _TEXT:0139
??000A				  Near	 _TEXT:0166
??000B				  Near	 _TEXT:016D
??DATE				  Text	 "02/17/22"
??FILENAME			  Text	 "mopl1	  "
??TIME				  Text	 "17:21:06"
??VERSION			  Number 030A
@32BIT				  Text	 0
@@E				  Near	 _TEXT:02EA
@@L				  Near	 _TEXT:0027
@CODE				  Text	 _TEXT
@CODESIZE			  Text	 0
@CPU				  Text	 0F0FH
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 MOPL1
@INTERFACE			  Text	 00H
@MODEL				  Text	 2
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BACK				  Near	 _TEXT:01FA
BEGIN				  Near	 _TEXT:0000
BUF				  Byte	 DGROUP:01DC
BUFLEN				  Number 0046
CALC				  Near	 _TEXT:0248
CEXIT				  Near	 _TEXT:01FD
CFUNC				  Near	 _TEXT:0211
CHCOMMA				  Number 0060
CHCR				  Number 000D
CHESC				  Number 001B
CHLF				  Number 000A
CHOC				  Byte	 DGROUP:0129
CHOICE				  Near	 _TEXT:029D
CHSEP				  Number 003D
CMINUS				  Near	 _TEXT:01E7
DEPT				  Byte	 DGROUP:00C5
DOSFU				  Number 0021
EMPTYS				  Byte	 DGROUP:01DB
FUEXIT				  Number 004C
FUGETCH				  Number 0008
FUGETS				  Number 000A
FUNC				  Near	 _TEXT:024B
FUPUTC				  Number 0002
GETCH				  Near	 _TEXT:---- Extern
Turbo Assembler	 Version 3.1	    02/17/22 17:21:07	    Page 12
Symbol Table



GETS				  Near	 _TEXT:---- Extern
INPUT				  Near	 _TEXT:024B
L1				  Near	 _TEXT:022A
LABR				  Byte	 DGROUP:0110
LENNUM				  Number 0012
LENPACK				  Number 0009
LENS				  Byte	 DGROUP:01DD
MINIS				  Byte	 DGROUP:005F
MOP				  Byte	 DGROUP:00E6
N				  Byte	 DGROUP:01C7
NEWLINE				  Byte	 DGROUP:017E
OUTBIN				  Near	 _TEXT:02B4
O_0				  Byte	 DGROUP:01AD
O_1				  Byte	 DGROUP:01AB
PAUSE				  Word	 DGROUP:0224
PAUSE_H				  Number 0000
PAUSE_L				  Number 0000
PRINT_EBX			  Near	 _TEXT:02B9
PRINT_EBX_1			  Near	 _TEXT:02D5
PUTC				  Near	 _TEXT:---- Extern
PUTSS				  Near	 _TEXT:---- Extern
REQ				  Byte	 DGROUP:004F
REQ1				  Byte	 DGROUP:0134
REQ2				  Byte	 DGROUP:0180
SLEN				  Near	 _TEXT:---- Extern
SLINE				  Byte	 DGROUP:0000
SNAME				  Byte	 DGROUP:01DE
TACTS				  Byte	 DGROUP:01AF
TI				  Byte	 DGROUP:0228
ULSTU				  Byte	 DGROUP:008E
UTOA10				  Near	 _TEXT:---- Extern
X				  Byte	 DGROUP:01A5
XN				  Byte	 DGROUP:01D0
XNUM				  Dword	 DGROUP:01CC
XN_1				  Near	 _TEXT:023C
XN_INPUT			  Near	 _TEXT:0221
Y				  Byte	 DGROUP:01D4
YNUM				  Word	 DGROUP:01D9

Macro Name

DURAT
EXIT
FIXTIME
PUTL
PUTLS
PUTLSC

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  STACK				  16  0200 Para	  Stack	  STACK
  _DATA				  16  0244 Word	  Public  DATA
_TEXT				  16  02F0 Word	  Public  CODE
